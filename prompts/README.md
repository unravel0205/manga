# プロンプト設定ガイド

このフォルダには、漫画生成のプロンプトテンプレートが格納されています。

## ファイル構成

```
prompts/
  ├── 01_分析_text.txt
  ├── 02_画像生成_image.txt
  └── README.md
```

## ファイル名の規則

```
[順序]_[表示名]_[タイプ].txt
```

### 例

- `01_分析_text.txt` → Step 1、名前「分析」、テキスト生成
- `02_構成_text.txt` → Step 2、名前「構成」、テキスト生成
- `03_画像生成_image.txt` → Step 3、名前「画像生成」、画像生成

### ルール

- **順序**: `01`〜`99`の2桁数字
- **表示名**: UI上で表示される名前（日本語OK）
- **タイプ**: `text`（テキスト生成）または `image`（画像生成）
- **拡張子**: 必ず `.txt`

## ステップの追加方法

### 3ステップにする例

1. 新しいファイルを作成
   ```
   prompts/02_構成_text.txt
   ```

2. 既存の`02_画像生成_image.txt`をリネーム
   ```bash
   mv 02_画像生成_image.txt 03_画像生成_image.txt
   ```

3. アプリを再読み込み → 自動で3ステップ認識されます

## 自動検出の仕組み

- アプリ起動時に`01`から順番にファイルを探索
- 各番号で複数のパターン（分析、構成、詳細、画像生成など）を試行
- 最初に見つかったファイルを読み込み
- 最大10ステップまで対応

## 利用可能な変数

プロンプトテンプレート内で以下の変数が使用できます：

### 基本変数
- `{{STORY}}` - ユーザーが入力したストーリー
- `{{STYLE_PROMPT}}` - 選択された絵のテイスト
- `{{SPEECH_STYLE}}` - セリフスタイルの詳細ルール
- `{{CHARACTER_RULE}}` - キャラクター人数ルール
- `{{CHARACTER_COUNT}}` - キャラクター数（「1人のキャラクター」等）
- `{{CHARACTER_DESCRIPTION}}` - キャラクター説明

### 前ステップの出力
- `{{PREV_OUTPUT}}` - 直前のステップの出力
- `{{STEP1_OUTPUT}}` - ステップ1の出力
- `{{STEP2_OUTPUT}}` - ステップ2の出力
- `{{STEP3_OUTPUT}}` - ステップ3の出力
- `{{GENERATED_PROMPT}}` - 最後のテキスト生成の出力

## プロンプト例

### 01_分析_text.txt
```
ストーリーを分析してください。

【ストーリー】
{{STORY}}

【絵のテイスト】
{{STYLE_PROMPT}}

---
4コマ構成の提案をしてください。
```

### 02_構成_text.txt
```
前のステップの分析結果をもとに、詳細な構成を設計してください。

【分析結果】
{{PREV_OUTPUT}}

---
各コマの構図、表情、背景、セリフを具体的に指定してください。
```

### 03_画像生成_image.txt
```
以下の指示で4コマ漫画を生成してください。

{{PREV_OUTPUT}}

【画像仕様】
・縦長1枚、アスペクト比 2:3
・4K高解像度
・カラー漫画
```

## 注意事項

- 最後のステップは必ず `_image.txt` にしてください
- ファイル名は数字で始めることを推奨（01, 02, 03...）
- 番号が飛んでいても動作します（01, 03, 05...）
- ステップ数が増えると生成時間とコストが増加します

## トラブルシューティング

### ファイルが読み込まれない

1. ファイル名の形式を確認
   - ✅ `01_分析_text.txt`
   - ❌ `01分析text.txt`（アンダースコアなし）
   - ❌ `1_分析_text.txt`（01ではなく1）

2. ブラウザコンソールでエラーを確認
   - 開発者ツール → Console

3. ローカルサーバーで起動しているか確認
   ```bash
   python3 -m http.server 8000
   ```

### 変数が置換されない
- 変数名が正確に `{{変数名}}` の形式か確認
- 大文字小文字を区別（`{{STORY}}` ≠ `{{story}}`）
